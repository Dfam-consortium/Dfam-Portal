<div *ngIf="family">

<button mat-fab color="primary" id="save-button"
    [disabled]="saving" (click)="saveFamily()">
  <mat-icon aria-hidden="false" aria-label="Save">save</mat-icon>
</button>

<button mat-fab color="secondary" id="refresh-button"
    [disabled]="saving" (click)="getFamily()">
  <mat-icon aria-hidden="false" aria-label="Refresh">refresh</mat-icon>
</button>


<h2>{{family.accession}}.{{family.version}}</h2>

<div style="clear: both"></div>

<mat-card>
<mat-card-title>Info</mat-card-title>

<mat-card-content>
  <mat-form-field class="wide">
    <input matInput type="text" placeholder="Name"
      [formControl]="familyForm.controls.name">
  </mat-form-field>

  <mat-form-field class="wide">
    <input matInput type="text" placeholder="Title"
      [formControl]="familyForm.controls.title">
  </mat-form-field>

  <mat-form-field class="wide">
    <textarea matInput placeholder="Description" [formControl]="familyForm.controls.description"></textarea>
  </mat-form-field>
</mat-card-content>
</mat-card>

<mat-card>
<mat-card-title>Classification</mat-card-title>

<mat-card-content>
  {{ displayClassById(familyForm.controls.classification_id.value) | async }}
</mat-card-content>

<mat-card-actions align="end">
  <button mat-raised-button (click)="pickClassification()"><mat-icon>list</mat-icon> Choose</button>
</mat-card-actions>
</mat-card>

<mat-card>
<mat-card-title>Taxa <workbench-warning-icon></workbench-warning-icon></mat-card-title>

<mat-list>
  <mat-list-item *ngFor="let control of this.familyForm.controls.clades.controls; index as i;">
    <mat-form-field class="wide">
      <mat-label></mat-label>
      <input matInput type="text" placeholder="Clade"
          [matAutocomplete]="clade_autocomplete"
          [formControl]="control"
          (input)="this.cladeSearchTerm.next($event.target.value)">
      <mat-autocomplete #clade_autocomplete="matAutocomplete"
          [displayWith]="displayClade" panelWidth="40em"
          (optionSelected)="this.cladeSearchTerm.next('')">
        <mat-option *ngFor="let clade of cladeOptions" class="clade-option" [value]="clade">
          <span [innerHTML]="clade.name_markup"></span>
        </mat-option>
      </mat-autocomplete>
      <button mat-icon-button matSuffix (click)="this.familyForm.controls.clades.removeAt(i)">
        <mat-icon>remove_circle_outline</mat-icon>
      </button>
    </mat-form-field>
  </mat-list-item>
</mat-list>

<mat-card-actions align="end">
  <button mat-raised-button (click)="addClade()"><mat-icon>add</mat-icon> Add</button>
</mat-card-actions>
</mat-card>

<mat-card>
<mat-card-title>Curation Details</mat-card-title>

<mat-card-content>
  <mat-form-field class="wide">
    <mat-select placeholder="Curation Status"
      [formControl]="familyForm.controls.curation_state_name">
      <mat-option value="Submitted">Submitted</mat-option>
      <mat-option value="Accepted">Accepted</mat-option>
      <mat-option value="Rejected">Rejected</mat-option>
      <mat-option value="Released">Released</mat-option>
    </mat-select>
    <workbench-warning-icon matSuffix></workbench-warning-icon>
  </mat-form-field>

  <p>
    <mat-checkbox [formControl]="familyForm.controls.disabled">Disabled</mat-checkbox>
    <workbench-warning-icon></workbench-warning-icon>
  </p>

  <p><strong>Length:</strong> {{family.length}} </p>

  <mat-form-field>
    <input matInput type="text" placeholder="Target Site Duplication" [formControl]="familyForm.controls.target_site_cons">
  </mat-form-field>

  <mat-form-field class="wide">
    <textarea matInput placeholder="Curation Notes" [formControl]="familyForm.controls.curation_notes"></textarea>
  </mat-form-field>
</mat-card-content>

</mat-card>

<mat-card>
<mat-card-title>Citations</mat-card-title>

<mat-list>
  <mat-list-item *ngFor="let group of this.familyForm.controls.citations.controls; index as i;">
    <mat-form-field fxFlex="auto">
      <input matInput type="number" placeholder="PubMed ID"
        [formControl]="group.controls.pmid">
    </mat-form-field>
    <mat-form-field fxFlex="auto" fxFlexOffset="1em">
      <input matInput type="text" placeholder="Comment"
        [formControl]="group.controls.comment">
    </mat-form-field>
    <button mat-icon-button fxFlexOffset="2em"
        (click)="this.familyForm.controls.citations.removeAt(i)">
      <mat-icon>remove_circle_outline</mat-icon>
    </button>
  </mat-list-item>
</mat-list>

<mat-card-actions align="end">
  <button mat-raised-button (click)="addCitation()"><mat-icon>add</mat-icon> Add</button>
</mat-card-actions>

</mat-card>

<mat-card>
<mat-card-title>Aliases</mat-card-title>

<mat-list>
  <mat-list-item
      *ngFor="let group of this.familyForm.controls.aliases.controls; index as i;">
    <mat-form-field fxFlex="auto">
      <input matInput type="text" placeholder="Database"
        [formControl]="group.controls.database">
    </mat-form-field>
    <mat-form-field fxFlex="auto" fxFlexOffset="1em">
      <input matInput type="text" placeholder="Alias"
        [formControl]="group.controls.alias">
    </mat-form-field>
    <mat-form-field fxFlex="auto" fxFlexOffset="1em">
      <input matInput type="text" placeholder="Comment"
        [formControl]="group.controls.comment">
    </mat-form-field>
    <mat-checkbox fxFlexOffset="1em"
        [formControl]="group.controls.deprecated">
      Deprecated
    </mat-checkbox>
    <button mat-icon-button fxFlexOffset="2em"
        (click)="this.familyForm.controls.aliases.removeAt(i)">
      <mat-icon>remove_circle_outline</mat-icon>
    </button>
  </mat-list-item>
</mat-list>

<mat-card-actions align="end">
  <button mat-raised-button (click)="addAlias()"><mat-icon>add</mat-icon> Add</button>
</mat-card-actions>
</mat-card>

<mat-card>
<mat-card-title>Source</mat-card-title>

<p><strong>Submitter:</strong> {{family.submitter || "Unknown"}}</p>
<p>
  <mat-form-field class="wide">
    <input matInput type="text" placeholder="Author(s)" [formControl]="familyForm.controls.author">
  </mat-form-field>
</p>
<p><strong>Created On:</strong> {{family.date_created | date: 'medium'}}</p>
<p><strong>Modified On:</strong> {{family.date_modified | date: 'medium'}}</p>

</mat-card>

<div *ngIf="!family">
Loading data...
</div>
