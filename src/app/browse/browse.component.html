<div class='dfam-browse' fxFlex="50" fxFlexOffset="25">
  <div fxLayout="column">
    <h2>Browse Entries</h2>
    <mat-divider></mat-divider>

    <mat-card>
      <mat-form-field>
        <input matInput type="text"
            placeholder="Family Name"
            [(ngModel)]="search.name"
            (input)="searchChanged()">
      </mat-form-field>

      <mat-form-field>
        <input matInput type="text"
            placeholder="Classification"
            [(ngModel)]="search.classification"
            [matAutocomplete]="classAutocomplete"
            (input)="updateClasses()">
      </mat-form-field>
      <mat-autocomplete
          #classAutocomplete="matAutocomplete"
          [displayWith]="displayClass"
          panelWidth="40em"
          (optionSelected)="searchChanged()">
        <mat-option
            class="classification-option"
            *ngFor="let class of classOptions"
            [value]="class">
          <span [innerHTML]="class.name_markup"></span>
          <span *ngIf="class.count"> [{{class.count}}]</span>
        </mat-option>
      </mat-autocomplete>

      <mat-form-field>
        <input matInput type="text"
            placeholder="Clade"
            [(ngModel)]="search.clade"
            [matAutocomplete]="cladeAutocomplete"
            (input)="updateClades()">
      </mat-form-field>
      <mat-autocomplete
          #cladeAutocomplete="matAutocomplete"
          panelWidth="40em"
          (optionSelected)="searchChanged()">
        <mat-option
            class="clade-option"
            *ngFor="let clade of cladeOptions"
            [value]="clade.species_name">
          <span [innerHTML]="clade.name_markup"></span>
        </mat-option>
      </mat-autocomplete>

      <mat-checkbox
          [(ngModel)]="search.clade_ancestors"
          (change)="searchChanged()">
        Ancestors
      </mat-checkbox>

      <mat-checkbox
          [(ngModel)]="search.clade_descendants"
          (change)="searchChanged()">
        Descendants
      </mat-checkbox>

      <mat-form-field>
        <input matInput type="text"
            placeholder="Keywords"
            [(ngModel)]="search.keywords"
            (input)="searchChanged()">
      </mat-form-field>

      <p>Total results: {{families.total_count}}</p>
    </mat-card>

    <div class="browse">
       <table mat-table matSort (matSortChange)="sortChanged($event)"
             [dataSource]="families.results">
         <ng-container matColumnDef="accession">
           <th mat-header-cell *matHeaderCellDef mat-sort-header>Accession</th>
           <td mat-cell *matCellDef="let family">
             <a routerLink="/family/{{family.accession}}">
               {{family.accession}}
             </a>
           </td>
         </ng-container>
         <ng-container matColumnDef="name">
           <th mat-header-cell *matHeaderCellDef mat-sort-header>Name</th>
           <td mat-cell *matCellDef="let family">{{family.name}}</td>
         </ng-container>
         <ng-container matColumnDef="classification">
           <th mat-header-cell *matHeaderCellDef>Classification</th>
           <td mat-cell *matCellDef="let family">
             <span [matTooltip]="family.classification">
               {{family.classification.substring(family.classification.lastIndexOf(';') + 1)}}
             </span>
           </td>
         </ng-container>
         <ng-container matColumnDef="clades">
           <th mat-header-cell *matHeaderCellDef>Clades</th>
           <td mat-cell *matCellDef="let family">{{family.clades.join(", ")}}</td>
         </ng-container>
         <ng-container matColumnDef="description">
           <th mat-header-cell *matHeaderCellDef>Description</th>
           <td mat-cell *matCellDef="let family">{{family.description}}</td>
         </ng-container>
         <ng-container matColumnDef="length">
           <th mat-header-cell *matHeaderCellDef mat-sort-header>Length</th>
           <td mat-cell *matCellDef="let family">{{family.length}}</td>
         </ng-container>
         <ng-container matColumnDef="abundance">
           <th mat-header-cell *matHeaderCellDef mat-sort-header>Abundance</th>
           <td mat-cell *matCellDef="let family">{{family.abundance}}</td>
         </ng-container>

         <tr mat-header-row *matHeaderRowDef="displayColumns"></tr>
         <tr mat-row *matRowDef="let families; columns: displayColumns"></tr>
       </table>
       <mat-paginator [pageSize]="20" [pageSizeOptions]="[20,50,100]" [length]="families?.total_count" (page)="pageChanged($event)"></mat-paginator>
    </div>
  </div>
</div>
